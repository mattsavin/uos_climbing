
> uos_climbing@0.0.0 test:backend
> NODE_ENV=test vitest run


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/home/msavin/WebstormProjects/uos_climbing[39m

[90mstdout[2m | tests/backend/gear.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/gear.test.ts
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/gear.test.ts
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/gear.test.ts
[22m[39mRoot admin created.

 [31mâ¯[39m tests/backend/gear.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 886[2mms[22m[39m
     [32mâœ“[39m should allow admin to create gear[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should list gear[39m[32m 22[2mms[22m[39m
[31m     [31mÃ—[31m should allow user to request gear[39m[32m 12[2mms[22m[39m
[31m     [31mÃ—[31m should allow admin to approve gear request[39m[32m 14[2mms[22m[39m
[31m     [31mÃ—[31m should show user gear requests[39m[32m 14[2mms[22m[39m
     [32mâœ“[39m should allow admin to update gear[32m 9[2mms[22m[39m
     [32mâœ“[39m should allow admin to delete gear[32m 8[2mms[22m[39m
[31m     [31mÃ—[31m should prevent requesting out of stock gear[39m[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should allow admin to reject gear request[39m[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should allow admin to mark gear as returned[39m[32m 14[2mms[22m[39m
     [32mâœ“[39m should view all requests as Kit Sec[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m should let user view their own requests[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should handle list gear DB errors[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle list all requests DB errors[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle list my requests DB errors[39m[32m 3[2mms[22m[39m
       [32mâœ“[39m should handle create gear DB errors[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle update gear DB errors[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle delete gear DB errors[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should handle create request DB errors (GET)[39m[32m 3[2mms[22m[39m
       [32mâœ“[39m should handle reject request DB errors[32m 9[2mms[22m[39m
[90mstdout[2m | tests/backend/sessions.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/sessions.test.ts[2m > [22m[2mSessions API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/sessions.test.ts[2m > [22m[2mSessions API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/sessions.test.ts[2m > [22m[2mSessions API
[22m[39mRoot admin created.

 [31mâ¯[39m tests/backend/sessions.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 865[2mms[22m[39m
[31m     [31mÃ—[31m should allow committee to create a session[39m[32m 19[2mms[22m[39m
[31m     [31mÃ—[31m should list sessions[39m[32m 12[2mms[22m[39m
[31m     [31mÃ—[31m should allow user to book a session[39m[32m 12[2mms[22m[39m
[31m     [31mÃ—[31m should prevent double booking[39m[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should show user bookings[39m[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should allow user to cancel booking[39m[32m 10[2mms[22m[39m
[31m     [31mÃ—[31m should allow committee to update a session[39m[32m 7[2mms[22m[39m
[31m     [31mÃ—[31m should allow committee to delete a session[39m[32m 6[2mms[22m[39m
[31m     [31mÃ—[31m should prevent booking a full session[39m[32m 11[2mms[22m[39m
[31m     [31mÃ—[31m should prevent cancelling a booking you do not have[39m[32m 6[2mms[22m[39m
[31m     [31mÃ—[31m should generate iCal file for user bookings[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle list sessions DB errors[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle iCal DB errors (user fetch)[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle iCal DB errors (sessions fetch)[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should handle create session DB errors[39m[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle update session DB errors[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should handle get bookings DB errors[39m[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle book session DB errors[39m[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle cancel session DB errors (get booking)[39m[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should handle delete session DB errors[39m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/backend/middleware.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/middleware.test.ts[2m > [22m[2mMiddleware Auth API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/middleware.test.ts[2m > [22m[2mMiddleware Auth API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/middleware.test.ts[2m > [22m[2mMiddleware Auth API
[22m[39mRoot admin created.

 [31mâ¯[39m tests/backend/middleware.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 573[2mms[22m[39m
     [2m[90mâ†“[39m[22m requires auth token for protected routes
     [2m[90mâ†“[39m[22m blocks regular members from accessing admin routes
     [2m[90mâ†“[39m[22m allows committee members to access admin routes
     [2m[90mâ†“[39m[22m blocks regular committee members from creating gear
     [2m[90mâ†“[39m[22m allows Kit & Safety Sec to create gear
[90mstdout[2m | tests/backend/voting.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/voting.test.ts[2m > [22m[2mVoting API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/voting.test.ts[2m > [22m[2mVoting API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/voting.test.ts[2m > [22m[2mVoting API
[22m[39mRoot admin created.

 [31mâ¯[39m tests/backend/voting.test.ts [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 557[2mms[22m[39m
     [2m[90mâ†“[39m[22m should fail to apply when elections are closed
     [2m[90mâ†“[39m[22m should be able to see voting status
     [2m[90mâ†“[39m[22m should list candidates
     [2m[90mâ†“[39m[22m should allow application when elections are open
     [2m[90mâ†“[39m[22m should reject double application
     [2m[90mâ†“[39m[22m should process a valid vote
     [2m[90mâ†“[39m[22m should reject double voting
[90mstdout[2m | tests/backend/users.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/users.test.ts[2m > [22m[2mUsers API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/users.test.ts[2m > [22m[2mUsers API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/users.test.ts[2m > [22m[2mUsers API
[22m[39mRoot admin created.

 [32mâœ“[39m tests/backend/users.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 4226[2mms[22m[39m
     [33m[2mâœ“[22m[39m should update password with correct current password [33m 566[2mms[22m[39m
[90mstdout[2m | tests/backend/auth.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API
[22m[39mRoot admin created.

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API[2m > [22m[2mEmail Verification[2m > [22m[2mshould verify email with a correct OTP
[22m[39mEmail sent successfully: { messageId: [32m'mock-id'[39m }

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API[2m > [22m[2mEmail Verification[2m > [22m[2mshould resend a verification code for an unverified user
[22m[39mEmail sent successfully: { messageId: [32m'mock-id'[39m }

[90mstdout[2m | tests/backend/auth.test.ts[2m > [22m[2mAuthentication API[2m > [22m[2mEmail Verification[2m > [22m[2mPassword Reset Flow[2m > [22m[2mshould generate a token and return 200 for forgot-password with valid email
[22m[39mEmail sent successfully: { messageId: [32m'mock-id'[39m }

 [32mâœ“[39m tests/backend/auth.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 2450[2mms[22m[39m
     [33m[2mâœ“[22m[39m should reject login after user deletion [33m 304[2mms[22m[39m
[90mstdout[2m | tests/backend/admin.test.ts
[22m[39mConnected to the SQLite database.

[90mstdout[2m | tests/backend/admin.test.ts[2m > [22m[2mAdmin API
[22m[39mSeeding default sessions...

[90mstdout[2m | tests/backend/admin.test.ts[2m > [22m[2mAdmin API
[22m[39mSeeding default gear...

[90mstdout[2m | tests/backend/admin.test.ts[2m > [22m[2mAdmin API
[22m[39mRoot admin created.

[90mstdout[2m | tests/backend/admin.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mshould allow root admin to assign committee roles
[22m[39mEmail sent successfully: { messageId: [32m'mock-id'[39m }

[90mstdout[2m | tests/backend/admin.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mshould allow root admin to demote a user
[22m[39mEmail sent successfully: { messageId: [32m'mock-id'[39m }

 [32mâœ“[39m tests/backend/admin.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 2360[2mms[22m[39m
[90mstdout[2m | tests/backend/email.test.ts[2m > [22m[2mEmail Service[2m > [22m[2mshould successfully send an email
[22m[39mEmail sent successfully: [33mtrue[39m

 [32mâœ“[39m tests/backend/email.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 2 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/backend/middleware.test.ts[2m > [22mMiddleware Auth API
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/backend/middleware.test.ts:[2m35:36[22m[39m
    [90m 33| [39m        const tc3 = u3.headers['set-cookie']?.find((c: string) => c.stâ€¦
    [90m 34| [39m        kitToken [33m=[39m tc3 [33m?[39m tc3[33m.[39m[34msplit[39m([32m';'[39m)[[34m0[39m][33m.[39m[34msplit[39m([32m'='[39m)[[34m1[39m] [33m:[39m [32m''[39m[33m;[39m
    [90m 35| [39m        [35mconst[39m kitId [33m=[39m u3[33m.[39mbody[33m.[39muser[33m.[39mid[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 36| [39m
    [90m 37| [39m        [90m// Login Admin[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/voting.test.ts[2m > [22mVoting API
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/backend/voting.test.ts:[2m25:36[22m[39m
    [90m 23| [39m        const tokenCookie1 = userRes.headers['set-cookie']?.find((c: sâ€¦
    [90m 24| [39m        userToken = tokenCookie1 ? tokenCookie1.split(';')[0].split('=â€¦
    [90m 25| [39m        userId [33m=[39m userRes[33m.[39mbody[33m.[39muser[33m.[39mid[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 26| [39m    })[33m;[39m
    [90m 27| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/31]â¯[22m[39m


[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 29 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould list gear
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m79:28[22m[39m
    [90m 77| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m 78| [39m
    [90m 79| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 80| [39m        [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(res[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 81| [39m        [34mexpect[39m(res[33m.[39mbody[33m.[39m[34msome[39m((g[33m:[39m any) [33m=>[39m g[33m.[39mid [33m===[39m gearId))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould allow user to request gear
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m90:28[22m[39m
    [90m 88| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m 89| [39m
    [90m 90| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 91| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m 92| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'requestId'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould allow admin to approve gear request
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m108:28[22m[39m
    [90m106| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39madminToken[36m}[39m[32m`[39m)[33m;[39m
    [90m107| [39m
    [90m108| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m109| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m110| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould show user gear requests
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m130:28[22m[39m
    [90m128| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m129| [39m
    [90m130| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m131| [39m        expect(res.body.some((r: any) => r.id === requestId)).toBe(truâ€¦
    [90m132| [39m        expect(res.body.find((r: any) => r.id === requestId)).toHavePrâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould prevent requesting out of stock gear
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m174:28[22m[39m
    [90m172| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m173| [39m
    [90m174| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m175| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'error'[39m[33m,[39m [32m'Gear out of stock'[39m)[33m;[39m
    [90m176| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould allow admin to reject gear request
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m190:28[22m[39m
    [90m188| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39madminToken[36m}[39m[32m`[39m)[33m;[39m
    [90m189| [39m
    [90m190| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m191| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m192| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould allow admin to mark gear as returned
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m210:28[22m[39m
    [90m208| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39madminToken[36m}[39m[32m`[39m)[33m;[39m
    [90m209| [39m
    [90m210| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m211| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m212| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mshould let user view their own requests
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m222:28[22m[39m
    [90m220| [39m    [34mit[39m([32m'should let user view their own requests'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m221| [39m        const res = await request(app).get('/api/gear/me/requests').seâ€¦
    [90m222| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m223| [39m        [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(res[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m224| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mDatabase Errors[2m > [22mshould handle list gear DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m231:32[22m[39m
    [90m229| [39m            const spy = vi.spyOn(db, 'all').mockImplementationOnce((quâ€¦
    [90m230| [39m            const res = await request(app).get('/api/gear').set('Authoâ€¦
    [90m231| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m232| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m233| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mDatabase Errors[2m > [22mshould handle list my requests DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m247:32[22m[39m
    [90m245| [39m            const spy = vi.spyOn(db, 'all').mockImplementationOnce((quâ€¦
    [90m246| [39m            const res = await request(app).get('/api/gear/me/requests'â€¦
    [90m247| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m248| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m249| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/gear.test.ts[2m > [22mGear API[2m > [22mDatabase Errors[2m > [22mshould handle create request DB errors (GET)
[31m[1mAssertionError[22m: expected 401 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/gear.test.ts:[2m279:32[22m[39m
    [90m277| [39m            const spy = vi.spyOn(db, 'get').mockImplementationOnce((quâ€¦
    [90m278| [39m            const res = await request(app).post('/api/gear/1/request')â€¦
    [90m279| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m280| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m281| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould allow committee to create a session
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m93:28[22m[39m
    [90m 91| [39m            })[33m;[39m
    [90m 92| [39m
    [90m 93| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 94| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'id'[39m)[33m;[39m
    [90m 95| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould list sessions
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m103:63[22m[39m
    [90m101| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m102| [39m        [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(res[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m103| [39m        expect(res.body.some((s: any) => s.id === sessionId)).toBe(truâ€¦
    [90m   | [39m                                                              [31m^[39m
    [90m104| [39m    })[33m;[39m
    [90m105| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould allow user to book a session
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m112:28[22m[39m
    [90m110| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m111| [39m
    [90m112| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m113| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m114| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould prevent double booking
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m125:28[22m[39m
    [90m123| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m124| [39m
    [90m125| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m126| [39m        expect(res.body).toHaveProperty('error', 'Already booked this â€¦
    [90m127| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould show user bookings
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m137:28[22m[39m
    [90m135| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m136| [39m
    [90m137| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m138| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoContain[39m(sessionId)[33m;[39m
    [90m139| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould allow user to cancel booking
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m149:28[22m[39m
    [90m147| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m148| [39m
    [90m149| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m150| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m151| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould allow committee to update a session
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m162:28[22m[39m
    [90m160| [39m            })[33m;[39m
    [90m161| [39m
    [90m162| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m163| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m164| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould allow committee to delete a session
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m172:28[22m[39m
    [90m170| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39mcommitteeToken[36m}[39m[32m`[39m)[33m;[39m
    [90m171| [39m
    [90m172| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m173| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m174| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould prevent booking a full session
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m197:28[22m[39m
    [90m195| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muser2Token[36m}[39m[32m`[39m)[33m;[39m
    [90m196| [39m
    [90m197| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m198| [39m        [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'error'[39m[33m,[39m [32m'Session is full'[39m)[33m;[39m
    [90m199| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould prevent cancelling a booking you do not have
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m207:28[22m[39m
    [90m205| [39m            [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)[33m;[39m
    [90m206| [39m
    [90m207| [39m        [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m208| [39m        expect(res.body).toHaveProperty('error', 'You have not booked â€¦
    [90m209| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mshould generate iCal file for user bookings
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'calendarToken')[39m
[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m215:36[22m[39m
    [90m213| [39m        const meRes = await request(app).get('/api/auth/me').set('Authâ€¦
    [90m214| [39m        [35mconst[39m user [33m=[39m meRes[33m.[39mbody[33m.[39muser[33m;[39m
    [90m215| [39m        [35mconst[39m calendarToken [33m=[39m user[33m.[39mcalendarToken[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m216| [39m
    [90m217| [39m        const sessionId = await createSession(committeeToken, 'iCal Seâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle iCal DB errors (sessions fetch)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'calendarToken')[39m
[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m253:75[22m[39m
    [90m251| [39m            [35mconst[39m user [33m=[39m meRes[33m.[39mbody[33m.[39muser[33m;[39m
    [90m252| [39m
    [90m253| [39m            const res = await request(app).get(`/api/sessions/ical/${uâ€¦
    [90m   | [39m                                                                          [31m^[39m
    [90m254| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m255| [39m            spyAll[33m.[39m[34mmockRestore[39m()[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle create session DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m264:32[22m[39m
    [90m262| [39m                title[33m:[39m [32m'T'[39m[33m,[39m type[33m:[39m [32m'T'[39m[33m,[39m date[33m:[39m [32m'D'[39m[33m,[39m capacity[33m:[39m [34m1[39m
    [90m263| [39m            })[33m;[39m
    [90m264| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m265| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m266| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle update session DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m274:32[22m[39m
    [90m272| [39m                title: 'T', type: 'T', date: 'D', capacity: 1, bookedSâ€¦
    [90m273| [39m            })[33m;[39m
    [90m274| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m275| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m276| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle get bookings DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m282:32[22m[39m
    [90m280| [39m            const spy = vi.spyOn(db, 'all').mockImplementationOnce((quâ€¦
    [90m281| [39m            const res = await request(app).get('/api/sessions/me/bookiâ€¦
    [90m282| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m283| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m284| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[28/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle book session DB errors
[31m[1mAssertionError[22m: expected 401 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m292:32[22m[39m
    [90m290| [39m
    [90m291| [39m            const res = await request(app).post('/api/sessions/1/book'â€¦
    [90m292| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m293| [39m            spyGet1[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m294| [39m            spyGet2[33m.[39m[34mmockRestore[39m()[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[29/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle cancel session DB errors (get booking)
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m302:32[22m[39m
    [90m300| [39m
    [90m301| [39m            const res = await request(app).post('/api/sessions/1/canceâ€¦
    [90m302| [39m            expect(res.status).toBe(400); // Route logic checks if booâ€¦
    [90m   | [39m                               [31m^[39m
    [90m303| [39m            spyGet[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m304| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[30/31]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/backend/sessions.test.ts[2m > [22mSessions API[2m > [22mDatabase Errors[2m > [22mshould handle delete session DB errors
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2mâ¯[22m tests/backend/sessions.test.ts:[2m310:32[22m[39m
    [90m308| [39m            const spy = vi.spyOn(db, 'run').mockImplementationOnce((quâ€¦
    [90m309| [39m            const res = await request(app).delete('/api/sessions/1').sâ€¦
    [90m310| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m311| [39m            spy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m312| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[31/31]â¯[22m[39m


[2m Test Files [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (8)[39m
[2m      Tests [22m [1m[31m29 failed[39m[22m[2m | [22m[1m[32m73 passed[39m[22m[2m | [22m[33m12 skipped[39m[90m (114)[39m
[2m   Start at [22m 02:58:16
[2m   Duration [22m 16.78s[2m (transform 412ms, setup 205ms, import 2.64s, tests 11.92s, environment 2ms)[22m

